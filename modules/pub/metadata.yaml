# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: blueprints.cloud.google.com/v1alpha1
kind: BlueprintMetadata
metadata:
  name: terraform-google-pubsub-pub
  annotations:
    config.kubernetes.io/local-config: "true"
spec:
  info:
    title: terraform-google-pubsub
    source:
      repo: https://github.com/terraform-google-modules/terraform-google-pubsub
      sourceType: git
      dir: /modules/pub
    version: 8.0.1
    actuationTool:
      flavor: Terraform
      version: ">= 1.3"
    description: {}
  content:
    examples:
      - name: bigquery
        location: examples/bigquery
      - name: bigquery-separate-pub-sub
        location: examples/bigquery-separate-pub-sub
      - name: cloud_storage
        location: examples/cloud_storage
      - name: cloud_storage-separate-pub-sub
        location: examples/cloud_storage-separate-pub-sub
      - name: kms
        location: examples/kms
      - name: simple
        location: examples/simple
      - name: simple-separate-pub-sub
        location: examples/simple-separate-pub-sub
      - name: subscriptions_only
        location: examples/subscriptions_only
  interfaces:
    variables:
      - name: project_id
        description: The project ID to manage the Pub/Sub resources.
        varType: string
        required: true
      - name: topic
        description: The Pub/Sub topic name.
        varType: string
        required: true
      - name: topic_labels
        description: A map of labels to assign to the Pub/Sub topic.
        varType: map(string)
        defaultValue: {}
      - name: topic_message_retention_duration
        description: The minimum duration in seconds to retain a message after it is published to the topic.
        varType: string
      - name: message_storage_policy
        description: A map of storage policies. Default - inherit from organization's Resource Location Restriction policy.
        varType: map(any)
        defaultValue: {}
      - name: topic_kms_key_name
        description: The resource name of the Cloud KMS CryptoKey to be used to protect access to messages published on this topic.
        varType: string
      - name: schema
        description: Schema for the topic.
        varType: |-
          object({
              name       = string
              type       = string
              definition = string
              encoding   = string
            })
    outputs:
      - name: id
        description: The ID of the Pub/Sub topic
      - name: topic
        description: The name of the Pub/Sub topic
      - name: topic_labels
        description: Labels assigned to the Pub/Sub topic
      - name: uri
        description: The URI of the Pub/Sub topic
  requirements:
    roles:
      - level: Project
        roles:
          - roles/pubsub.admin
          - roles/resourcemanager.projectIamAdmin
          - roles/bigquery.admin
          - roles/storage.admin
    services:
      - cloudresourcemanager.googleapis.com
      - pubsub.googleapis.com
      - serviceusage.googleapis.com
      - bigquery.googleapis.com
      - storage.googleapis.com
    providerVersions:
      - source: hashicorp/google
        version: ">= 6.2, < 7"
